Kalibracia

Počas merania som si vsimol, že sa hodnoty kvoli vysokej citlivosti senzoru mozu velmi lisit, a teda je potrebna urcita kalibrácia. Ta je definovana vo funkcii calibration(), ktorá je zavolaná buď zo setup() alebo keď užívateľ stlačí počas merania tlačítko. Užívateľ je najprv vyzvaný aby priložil na senzor prst. Následne sa na displeji objaví 10 sekundový časovač. Ten indikuje dobu, počas ktorej senzor načítava hodnoty zo senzora, z ktorych je neskôr vypočítaná amplitúda (rozdiel najvyššej a najnižšej nameranej hodnoty ) a priemerná hodnota signalu. Z týchto hodnôt je neskôr ziskany horny a dolny prah, ktoré sluzia na detekciu jedného uderu srdca. Ak signál prekoná horný prah a následne prekoná dolný prah, znamená to že bol detekovaný jeden úder. Dolným prahom je v mojej implementácii priemerná hodnota signalu a horným súčet najnižšej nameranej hodnoty a 65% z amplitudy.
Ak po uvodnej kalibracii je stale signál prilis rusivy alebo nejasny, užívateľ moze kedykolvek senzor rekalibrovat stlacenim tlacitka na pozicii MID.

Meranie

Meranie funguje v nekonecnej slucke v loop() s oneskorenim 20 milisekund ( 50krat za sekundu). Kazdy cyklus kontroluje stlacenie tlacitka na kalibraciu a nasledne cita hodnotu so senzora. Táto hodnota sa prevedie na vertikálnu pozíciu na OLED displeji, kde sa spája s predchádzajúcim bodom do plynulej vlny, a vytvara živý graf pulzu, ktorý sa pomaly posúva zľava doprava. Ak signal prekona horny prah rozsvieti sa LED dioda a po prekonani spodneho prahu opat zhasne, co ma za nasledok efekt kedy dioda blika podla uderov srdca. Po prekonani spodneho prahu je uder oznaceny ako kompletny. Ked signal vystupi nad horny prah, zacne sa casovat interval a pri ďalšom prekročení horného prahu sa vypočíta tepová frekvencia delením 60 000 milisekúnd nameraným intervalom medzi údermi. Výsledná hodnota BPM sa spolu s aktuálnou číselnou hodnotou senzora zobrazuje v spodnej časti OLED displeja, pričom systém automaticky ignoruje neprijateľné hodnoty mimo rozsahu 45-120 úderov za minútu. 
